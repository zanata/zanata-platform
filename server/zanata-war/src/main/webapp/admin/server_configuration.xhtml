<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:a4j="http://richfaces.org/a4j"
  template="../WEB-INF/template/template.xhtml">

  <f:metadata>
    <f:event type="preRenderView" listener="#{identity.checkRole('admin')}"/>
  </f:metadata>

  <ui:define
    name="page_title">#{msgs['jsf.ServerConfiguration']}</ui:define>
  <ui:define name="center_content">
  <div class="g--centered">
    <div class="g__item w--3-4-m w--5-8-l w--1-3 l--push-bottom-1">
      <p class="txt--meta l--push-all-0">
        <h:link outcome="/admin/home.xhtml"
          value="#{msgs['jsf.Administration']}"/>
      </p>

      <h1 class="l--push-all-0">#{msgs['jsf.ServerConfiguration']}</h1>

      <h:form id="serverConfigForm">
        <div class="form__item l--push-top-1">
          <h:outputLabel for="url">#{msgs['jsf.ServerUrl']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.UrlToolTip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="url" componentId="urlField">
            <h:inputText id="url" value="#{serverConfigurationBean.serverUrl}">
              <a4j:ajax event="blur" render="urlField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.Url.placeholder']}" styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="registerUrl">#{msgs['jsf.RegisterUrl']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.RegisterUrlToolTip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="register" componentId="registerField">
            <h:inputText id="registerUrl" value="#{serverConfigurationBean.registerUrl}">
              <a4j:ajax event="blur" render="registerField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.RegisterUrl.placeholder']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="emailDomain">#{msgs['jsf.EmailDomainName']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.EmailDomainNameToolTip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="emailDomain" componentId="emailDomainField">
            <h:inputText id="emailDomain" value="#{serverConfigurationBean.emailDomain}">
              <a4j:ajax event="blur" render="emailDomainField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.email.domainName.placeholder']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="adminEml">#{msgs['jsf.config.AdminEmail']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.AdminEmail.tooltip']} #{msgs['jsf.config.AdminEmail.DoesNotChangeUserEmail']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="adminEmail" componentId="adminEmailField" >
            <h:inputText id="adminEml" value="#{serverConfigurationBean.adminEmail}">
              <a4j:ajax event="blur" render="adminEmailField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.email.placeholder']} #{msgs['jsf.email.list.placeholder']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="adminEml">#{msgs['jsf.config.permittedUserEmailDomain']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.permittedUserEmailDomain.tooltip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="permittedEmailDomains" componentId="permittedEmailDomainsField" >
            <h:inputText id="permittedEmailDomainsElm" value="#{serverConfigurationBean.permittedUserEmailDomains}">
              <a4j:ajax event="blur" render="permittedEmailDomains" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.email.domainName.placeholder']} #{msgs['jsf.email.list.placeholder']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="fromEml">#{msgs['jsf.config.FromEmailAddr']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.FromEmailAddr.tooltip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="fromEmail" componentId="fromEmailField">
            <h:inputText id="fromEml" value="#{serverConfigurationBean.fromEmailAddr}">
              <a4j:ajax event="blur" render="fromEmailField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.email.placeholder']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="termsOfUseUrlEml">#{msgs['jsf.config.TermsOfUseUrl']}
          <span class="txt--meta">
            <i class="i i--info" title="#{msgs['jsf.config.TermsOfUseUrltooltip']}"></i>
          </span>
          </h:outputLabel>
          <zanata:decorate id="termsOfUseUrl" componentId="termsOfUseUrlField">
            <h:inputText id="termsOfUseUrlEml" value="#{serverConfigurationBean.termsOfUseUrl}">
              <a4j:ajax event="blur" render="termsOfUseUrlField" execute="@this"/>
              <rich:placeholder value="#{msgs.format('jsf.config.TermsOfUseUrl.placeholder', serverConfigurationBean.defaultTermOfUseUrl)}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h:outputLabel for="helpInput">#{msgs['jsf.config.HelpUrl']}
          <span class="txt--meta">
            <i class="i i--info" title="#{msgs['jsf.config.HelpUrltooltip']}"></i>
          </span>
          </h:outputLabel>
          <zanata:decorate id="helpUrl" componentId="helpUrlField">
            <h:inputText id="helpInput" value="#{serverConfigurationBean.helpUrl}">
              <a4j:ajax event="blur" render="helpUrlField" execute="@this"/>
              <rich:placeholder value="#{msgs.format('jsf.config.HelpUrl.placeholder', serverConfigurationBean.defaultHelpUrl)}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <div class="form__item l--push-top-1">
          <h3 class="heading--secondary l--push-all-0">#{msgs['jsf.config.userEmail.heading']}</h3>
          <p>#{msgs['jsf.config.userEmail.description']}</p>
          <h:outputLabel for="displayUserEmail">#{msgs['jsf.config.userEmail.label']}</h:outputLabel>
          <h:selectBooleanCheckbox id="displayUserEmail" styleClass="l--push-h-quarter"
            value="#{serverConfigurationBean.displayUserEmail}"/>
        </div>

        <div class="form__item l--push-top-1">
          <h3 class="heading--secondary l--push-all-0">#{msgs['jsf.config.allowAnonymousUser.heading']}</h3>
          <p>#{msgs['jsf.config.allowAnonymousUser.description']}</p>
          <p class="txt--warning">#{msgs['jsf.config.allowAnonymousUser.warning']}</p>
          <h:outputLabel for="allowAnonymousUser">#{msgs['jsf.config.allowAnonymousUser.label']}</h:outputLabel>
          <h:selectBooleanCheckbox id="allowAnonymousUser" styleClass="l--push-h-quarter"
            value="#{serverConfigurationBean.allowAnonymousUser}"/>
        </div>

        <div class="form__item l--push-top-1">
          <h3 class="heading--secondary l--push-all-0">#{msgs['jsf.config.Log']}</h3>
          <p>#{msgs['jsf.config.EnableLogEmails.tooltip']}</p>

          <div class="l--push-top-half">
            <h:outputLabel>Enabled <i class="i i--info txt--meta"
              title="#{msgs['jsf.config.EnableLogEmails.tooltip']}"></i></h:outputLabel>
            <h:selectBooleanCheckbox id="enableLogCheck"
              value="#{serverConfigurationBean.enableLogEmail}"
              styleClass="l--push-h-quarter">
              <a4j:ajax execute="@this" render="emailLogSettings"/>
             </h:selectBooleanCheckbox>
          </div>
          <h:panelGroup layout="block"  id="emailLogSettings">
            <h:panelGroup layout="block"  styleClass="l--push-top-half" rendered="#{serverConfigurationBean.enableLogEmail}">
              <h:outputLabel>#{msgs['jsf.config.LogEmailLevel']}
                <span class="txt--meta l--push-right-quarter">
                  <i class="i i--info" title="#{msgs['jsf.config.LogEmailLevel.tooltip']}"></i>
                </span>
              </h:outputLabel>
              <h:selectOneMenu id="logEmailLvl"
                value="#{serverConfigurationBean.logEmailLevel}">
                <f:selectItem itemLabel="#{msgs['jsf.Warning']}"
                  itemValue="WARN"/>
                <f:selectItem itemLabel="#{msgs['jsf.Error']}"
                  itemValue="ERROR"/>
              </h:selectOneMenu>
            </h:panelGroup>
            <h:panelGroup layout="block"  styleClass="l--push-top-half" rendered="#{serverConfigurationBean.enableLogEmail}">
              <h:outputLabel for="logDestEml">#{msgs['jsf.config.LogDestEmail']}
              <span class="txt--meta">
                <i class="i i--info" title="#{msgs['jsf.config.LogDestEmail.tooltip']}"></i>
              </span>
              </h:outputLabel>
              <zanata:decorate id="logDestEmail" componentId="logDestEmailField">
                <h:inputText id="logDestEml" value="#{serverConfigurationBean.logDestinationEmails}">
                  <a4j:ajax event="blur" render="logDestEmailField" execute="@this"/>
                  <rich:placeholder value="#{msgs['jsf.email.placeholder']} #{msgs['jsf.email.list.placeholder']}"
                    styleClass="txt--neutral" />
                </h:inputText>
              </zanata:decorate>
            </h:panelGroup>
          </h:panelGroup>
        </div>

        <div class="form__item l--push-top-1">
          <h3 class="heading--secondary l--push-all-0">#{msgs['jsf.config.Piwik']}</h3>
          <p>#{msgs['jsf.config.Piwiktooltip']}</p>
          <p class="txt--warning">#{msgs['jsf.config.Piwik.warning']}</p>
          <div class="g--tight">
            <div class="w--3-4 w--s-3-4 g__item">
              <zanata:decorate id="piwikUrl" componentId="piwikUrlField">
                <h:inputText id="piwikUrlEml" value="#{serverConfigurationBean.piwikUrl}">
                  <a4j:ajax event="blur" render="piwikUrlField" execute="@this"/>
                  <rich:placeholder value="#{msgs['jsf.config.Piwik.url.placeholder']}"
                    styleClass="txt--neutral" />
                </h:inputText>
              </zanata:decorate>
            </div>
            <div class="w--1-4 w--s-1-4 g__item">
              <h:inputText id="piwikIdSiteEml"
                value="#{serverConfigurationBean.piwikIdSite}">
                <a4j:ajax event="blur" render="piwikIdSiteField"/>
                <rich:placeholder value="#{msgs['jsf.config.PiwikIdSite.placeholder']}"
                  styleClass="txt--neutral" />
              </h:inputText>
            </div>
          </div>
        </div>

        <div class="form__item l--push-top-1">
          <h3 class="heading--secondary l--push-all-0">#{msgs['jsf.config.client']}</h3>
          <h:outputLabel for="maxConcurrentPerApiKeyEml">#{msgs['jsf.config.MaxConcurrentRequestsPerApiKey']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.MaxConcurrentRequestsPerApiKeytooltip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="maxConcurrentPerApiKey" componentId="maxConcurrentPerApiKeyField">
            <h:inputText id="maxConcurrentPerApiKeyEml" value="#{serverConfigurationBean.maxConcurrentRequestsPerApiKey}">
              <a4j:ajax event="blur" render="maxConcurrentPerApiKeyField" execute="@this"/>
              <rich:placeholder value="default is 6" styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>

          <h:outputLabel for="maxActiveRequestsPerApiKeyEml">#{msgs['jsf.config.MaxActiveRequestsPerApiKey']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.MaxActiveRequestsPerApiKeytooltip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="maxActiveRequestsPerApiKey" componentId="maxActiveRequestsPerApiKeyField">
            <h:inputText id="maxActiveRequestsPerApiKeyEml" value="#{serverConfigurationBean.maxActiveRequestsPerApiKey}">
              <a4j:ajax event="blur" render="maxActiveRequestsPerApiKeyField" execute="@this"/>
              <rich:placeholder value="default is 2" styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>

          <h:outputLabel for="maxFilesPerUploadFieldInput">#{msgs['jsf.config.MaxFilesPerUpload']}
            <span class="txt--meta">
              <i class="i i--info" title="#{msgs['jsf.config.MaxFilesPerUploadTooltip']}"></i>
            </span>
          </h:outputLabel>
          <zanata:decorate id="maxFilesPerUpload" componentId="maxFilesPerUploadField">
            <h:inputText id="maxFilesPerUploadFieldInput" value="#{serverConfigurationBean.maxFilesPerUpload}">
              <a4j:ajax event="blur" render="maxFilesPerUploadField" execute="@this"/>
              <rich:placeholder value="#{msgs['jsf.config.MaxFilesPerUploadDefault']}"
                styleClass="txt--neutral" />
            </h:inputText>
          </zanata:decorate>
        </div>

        <h:commandButton value="#{msgs['jsf.Save']}" id="save" styleClass="button--primary"
            action="#{serverConfigurationBean.update}"/>
        <h:button outcome="/admin/home.xhtml" value="#{msgs['jsf.Cancel']}" id="cancel"
            styleClass="button button--link l--push-left-half"/>
      </h:form>
    </div>
  </div>
  </ui:define>
</ui:composition>

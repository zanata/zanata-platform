<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich">

  <script>
    function getDescriptionMessageCountField() {
      return jQuery('#' + jqSelector('#{rich:clientId('trans-memory-desc-count')}'));
    }

    function validateDescriptionField(textArea) {
      var len = 100 - textArea.value.length;
      getDescriptionMessageCountField().text('Characters left: ' + len);
      if (textArea.value.length > 100) {
        getDescriptionMessageCountField().addClass("txt--danger");
        getDescriptionMessageCountField().parent('div').addClass("form__item--error")
      } else {
        getDescriptionMessageCountField().removeClass("txt--danger");
        getDescriptionMessageCountField().parent('div').removeClass("form__item--error")
      }
    }
  </script>

  <div class="l--push-top-half form__item">
    <h:outputLabel for="slug">#{msgs['jsf.transmemory.TransMemoryId']}
      <span class="txt--meta"><i class="i i--info"
        title="#{msgs['jsf.transmemory.TransMemoryIdExample']}"></i>
      </span>
    </h:outputLabel>
    <zanata:decorate id="slug" componentId="slugField">
      <h:inputText id="slug" required="true"
        value="#{translationMemoryHome.instance.slug}"
        valueChangeListener="#{translationMemoryHome.verifySlugAvailable}">
        <a4j:ajax event="blur" render="slugField" execute="@this"/>
      </h:inputText>
    </zanata:decorate>
  </div>

  <div class="l--push-top-half form__item">
    <h:outputLabel for="description">#{msgs['jsf.Description']}</h:outputLabel>
    <zanata:decorate id="description" componentId="descriptionField">
      <h:inputTextarea id="description" required="false"
        value="#{translationMemoryHome.instance.description}"
        onkeyup="validateDescriptionField(this)">
        <f:validateLength maximum="100"/>
      </h:inputTextarea>
      <h:outputLabel id="trans-memory-desc-count" styleClass="txt--meta"></h:outputLabel>
    </zanata:decorate>
  </div>

  <div class="l--push-top-1">
    <h:commandButton id="save"
      value="#{msgs['jsf.Save']}"
      action="#{translationMemoryHome.persist}"
      rendered="#{!translationMemoryHome.managed}"
      styleClass="button--primary button--full"/>
    <h:commandButton id="update"
      value="#{msgs['jsf.Update']}"
      action="#{translationMemoryHome.update}"
      rendered="#{translationMemoryHome.managed}"
      styleClass="button--primary button--full"/>
  </div>

</ui:composition>

<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:flies="http://flies.fedorahosted.org/ui"
    template="../layout/template.xhtml"
                xmlns:a4j="http://richfaces.org/a4j">

<ui:define name="breadcrumbs">
  »
  <s:link view="/project/home.xhtml" propagation="none">Projects</s:link>
  »
  <s:link view="/project/project.xhtml" propagation="none">
    <f:param name="slug" value="#{projectIterationHome.instance.project.slug}"/>
    #{projectIterationHome.instance.project.name}
  </s:link>
  #{projectIterationHome.instance.name}
</ui:define>

<ui:define name="left_content">
  <rich:panel rendered="#{identity.loggedIn}">
    <f:facet name="header">Actions</f:facet>
    <s:link styleClass="action_link" view="/project/iteration_edit.xhtml" propagation="none">
      <f:param name="mslug" value="#{projectIterationHome.multiSlug}"/>
      Edit
    </s:link>
    <h:outputLink styleClass="action_link" value="#" id="link">
      Upload Project
      <rich:componentControl for="upload_panel" attachTo="link" operation="show" event="onclick"/>
    </h:outputLink>
    
  </rich:panel>
</ui:define>

<ui:define name="center_content">
  <rich:jQuery selector="#tab_projects" query="addClass('ui-tabs-selected')" />
  <h1>#{projectIterationHome.instance.project.name} : #{projectIterationHome.instance.name}</h1>

  <h:form>
    <rich:tabPanel switchType="ajax">
      <s:conversationId/>
      <rich:tab>
        <f:facet name="label">Statistics</f:facet>
        Stats
      </rich:tab>
      <rich:tab>
        <f:facet name="label">Content Manager</f:facet>
        <rich:tree style="width:45%; float:left;" nodeSelectListener="#{hProjectHome.processSelection}" 
            reRender="detailsPanel" ajaxSubmitSelection="true"  switchType="client"
            value="#{hProjectHome.rootNode}" var="item" ajaxKeys="#{null}" 
            treeNodeVar="treeNode" nodeFace="#{hProjectHome.getNodeFace(treeNode.data)}">
          <rich:treeNode type="folder" icon="/img/iconFolder.gif" iconLeaf="/img/iconFolder.gif">  
            <h:outputText value="#{item}"/>
          </rich:treeNode>        
          <rich:treeNode type="doc"> 
            <h:outputText value="#{item.name}"/> 
          </rich:treeNode>        
        </rich:tree>
        <s:div id="detailsPanel" style="float:left;">
          <s:div rendered="#{hProjectHome.isDocSelection()}">
            <s:decorate template="../layout/edit.xhtml">
              <ui:define name="label">Name</ui:define>
              #{hProjectHome.docNode.data.name}
            </s:decorate>
            
            <s:decorate template="../layout/edit.xhtml">
              <ui:define name="label">Content Type</ui:define>
              #{hProjectHome.docNode.data.contentType}
            </s:decorate>
    
            <s:decorate template="../layout/edit.xhtml">
              <ui:define name="label">Base Language</ui:define>
              #{hProjectHome.docNode.data.locale}
            </s:decorate>
    
            <s:decorate template="../layout/edit.xhtml">
              <ui:define name="label">Version</ui:define>
              #{hProjectHome.docNode.data.revision}
            </s:decorate>
          </s:div>
          <s:div rendered="#{not hProjectHome.isDocSelection()}">
            <em>Select a Document to view Details</em>
          </s:div>
        </s:div>
        <div style="clear:both;"/>
      </rich:tab>
    </rich:tabPanel>
  </h:form>

  <rich:modalPanel id="upload_panel" width="420" height="220">
    <f:facet name="header">Upload Project</f:facet>
    <p>This form allows you to upload an 
      <a href="http://openl10n.googlecode.com/">Open Localisation Project</a>
      to use as the base for your project. You can also do this via the 
      <a href="#">REST API</a>.
    </p>
    
    <h:form>
      <rich:fileUpload fileUploadListener="#{hProjectHome.listener}"
          maxFilesQuantity="1"
          listHeight="80px;" 
          id="upload"
          immediateUpload="true"
          onuploadcomplete="#{rich:component('upload_panel')}.hide()"
          acceptedTypes="olp, zip" allowFlash="false">
      </rich:fileUpload>    
      <div class="actionButtons">
        <h:commandButton value="Close"  onclick="#{rich:component('upload_panel')}.hide()"/>
      </div>
    </h:form>
  </rich:modalPanel>

</ui:define>

</ui:composition>

<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:flies="http://flies.fedorahosted.org/ui"
    xmlns:a4j="http://richfaces.org/a4j"
    template="layout/template_fullpage.xhtml">
    <ui:define name="page-title">
      #{translateAction.project.name} (#{translateAction.project.projectId}) 
      to #{translateAction.locale} - 
    </ui:define>
    <ui:define name="left_content">

      <a4j:form>
        <a4j:poll action="#{translateAction.ping()}" interval="5000" reRender="translatorsPanel"/>
      </a4j:form>
      
      <rich:panel bodyClass="panel-body-no-padding">
        <f:facet name="header">Project Tree</f:facet>
        <h:form>
		    <rich:dataTable id="documentsTable" value="#{documentTargets}" var="doc" rows="15" reRender="ds" rowClasses="docrow">
		      <rich:column filterBy="#{doc.template.name}" filterEvent="onkeyup">
   	            <a4j:commandLink reRender="documentsTable,titleofDocument,textFlowTable" action="#{translateAction.selectDocumentTarget}"
		      	  >
		      		<s:conversationId name="wid"/>
                	<h:outputText value="#{doc.template.name}" /> 
            	  </a4j:commandLink>
		      </rich:column>
              <f:facet name="footer">
                <rich:datascroller id="ds" rendered="#{documentTargets.size > 50}" styleClass="datacsr-mini"></rich:datascroller>
              </f:facet>
		    </rich:dataTable>
        </h:form>
      </rich:panel>
      <br/>
      <rich:panel id="translatorsPanel">
        <f:facet name="header">#{translateAction.workspace.translatorCount} translator(s) online</f:facet>
        <rich:dataTable width="150px" value="#{translateAction.workspace.translators}" var="translator">
          <rich:column>
            <img src="#{request.contextPath}/img/silk/user.png"/>
          </rich:column>
          <rich:column>
            #{translator.name}
          </rich:column>
          <rich:column>
            <div class="translator_color_block translator_color_block_#{translator.id}"/>
          </rich:column>
        </rich:dataTable>
        <!-- 
        <h3 style="border-bottom:1px solid;">Chat</h3>
        <strong>Asgeir:</strong> hello world...<br/>
        <strong>Admin:</strong> let them eat cake..
        <h:inputTextarea value="hello world" style="width:100%; height:50px;"/>
         -->
      </rich:panel>
      
    </ui:define>
    
    <ui:define name="center_content">
      <rich:jQuery selector="#tab_home" query="addClass('ui-tabs-selected')" />

      <rich:panel bodyClass="panel-body-no-padding">
        <f:facet name="header">
          <s:span id="titleofDocument">${selectedDocumentTarget.template.name}</s:span>
        </f:facet>
        
        <h:form>
        <rich:dataTable id="textFlowTable" 
            width="auto" value="#{textFlowTargets}" var="tut" rows="50" height="450px;" reRender="tuds"
            rowClasses="odd,even">
          <rich:column width="48%">
            <f:facet name="header">
                Source
              </f:facet>
              #{tut.textFlow.content}
          </rich:column>
          <rich:column width="48%">
              <f:facet name="header">
                Target
              </f:facet>
               #{tut.content}
          </rich:column>
            <rich:column>
              <a4j:commandLink reRender="translationWidget,tuInfoPanel" action="#{translateAction.selectTextFlowTarget}">
            <s:conversationId name="wid"/>
                  <img src="#{request.contextPath}/img/silk/page_edit.png" alt="Translate"/>
              </a4j:commandLink>
            </rich:column>
            <f:facet name="footer">
              <rich:datascroller id="tuds" rendered="#{textFlowTargets.size > 50}"></rich:datascroller>
            </f:facet>
        </rich:dataTable>
        </h:form>
        <h:form id="translationWidget" style="font-size:133%;">
          <div style="width:99%; padding:4px;">
            <h:outputText value="#{selectedTextFlowTarget.textFlow.content}" disabled="#{selectedDocumentTarget == null}"/>
          </div>
          <h:inputTextarea id="editorArea" value="#{selectedTextFlowTarget.content}" 
            disabled="#{selectedDocumentTarget == null}"
            style="width:99%;" rows="6">
          </h:inputTextarea>
          <rich:contextMenu event="oncontextmenu" attachTo="editorArea" submitMode="none">
              <rich:menuItem value="Zoom In" onclick="alert('a');" id="zin"></rich:menuItem>
              <rich:menuItem value="Zoom Out" onclick="alert('b');" id="zout"></rich:menuItem>
          </rich:contextMenu>          
          <a4j:commandButton action="#{translateAction.persistChanges}" reRender="textFlowTable"  value="save" />
        </h:form>
      </rich:panel>

    </ui:define>

    <ui:define name="right_content">
      <rich:panel id="tuInfoPanel">
        <f:facet name="header">Translation Unit Information</f:facet>
        <s:div rendered="#{selectedTextFlowTarget == null}">No unit selected</s:div>
        <s:div rendered="#{selectedTextFlowTarget != null}">
          <strong>Last Translator: </strong>Asgeir Frimannsson <em>(25 Mar 2009 20:13:13)</em><br/>
        </s:div>
      </rich:panel>
      <br/>
      <rich:panel>
        <f:facet name="header">Terminology</f:facet>
        (Show Relevant Terminology here)
      </rich:panel>
    </ui:define>
    
</ui:composition>

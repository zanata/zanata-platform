<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 4.0//EN"
  "http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd">

<urlrewrite>

  <rule>
    <from casesensitive="true">^([^?]*)\?dswid=([^&amp;]*)&amp;(.*)$</from>
    <to>$1?$3&amp;dswid=$2</to>
  </rule>

  <!-- Disable the Red Hat crawler -->
  <rule>
    <condition name="remote-addr">66.187.233.202</condition>
    <from>.*</from>
    <to last="true" type="temporary-redirect">/robots.txt</to>
  </rule>

  <!-- Disable anything that comes out of Microsoft -->
  <rule>
    <condition name="remote-addr">65.55.210.81</condition>
    <from>.*</from>
    <to last="true" type="temporary-redirect">/robots.txt</to>
  </rule>

  <!-- Dashboard Rules -->
  <rule>
    <from casesensitive="true">^/dashboard(/([^?]*)\??(.*))?$</from>
    <to last="true">/dashboard/home.seam$3</to>
  </rule>

  <!-- Search Rules -->
  <rule>
    <from casesensitive="true">^/search/([^/]+)/([^/]+)?$</from>
    <to last="true">/search.seam\?query=$1</to>
  </rule>

  <!-- Admin Rules -->
  <rule>
    <from casesensitive="true">^/admin/([^/\?\.]+)(\?.*)?$</from>
    <to last="true">/admin/$1.seam$2</to>
  </rule>


  <!-- Language rules -->
  <rule>
    <from casesensitive="true">^/language/view/([^/]+)(/([^?]*)\??(.*))?$</from>
    <to last="true">/language/language.seam\?id=$1&amp;$4</to>
  </rule>

  <rule>
    <from casesensitive="true">^/language/list(.+)?$</from>
    <to last="true">/language/home.seam$1</to>
  </rule>

  <!-- Project Rules -->

  <rule>
    <from casesensitive="true">^/project/add_iteration/([^/]+)/([^/]+)?$</from>
    <to last="true">/project/add_iteration.seam\?projectSlug=$1&amp;copyFromVersionSlug=$2</to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/create(.+)$</from>
    <to last="true">/project/create_project.seam?$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/view/([^/]+)(/([^?]*)\??(.*))?$</from>
    <to
      last="true">/project/project.seam\?slug=$1&amp;$4
    </to>
  </rule>


  <!-- Project Iteration Rules -->
  <rule>
    <from casesensitive="true">^/iteration/view/([^/]+)/([^/]+)(/([^?]*)\??(.*))?$
    </from>
    <to
      last="true">/iteration/view.seam\?projectSlug=$1&amp;iterationSlug=$2&amp;$4
    </to>
  </rule>



  <rule>
    <from casesensitive="true">^/iteration/source_files/([^/]+)/([^/]+)/?$
    </from>
    <to type="permanent-redirect"
      last="true">%{context-path}/iteration/view/$1/$2&amp;#documents
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/iteration/files/([^/]+)/([^/]+)/([^/]+)/?$
    </from>
    <to type="permanent-redirect"
      last="true">%{context-path}/iteration/view/$1/$2&amp;#documents
    </to>
  </rule>

  <!-- zanata.xml -->
  <rule>
    <from casesensitive="true">^/project/view/([^/]+)/iter/([^/]+)/config/?$
    </from>
    <to
      last="true">/project/project.seam\?projectSlug=$1&amp;iterationSlug=$2&amp;actionMethod=project%2Fproject.xhtml%3AconfigurationAction.getData
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/project/list(.+)?$</from>
    <to last="true">/project/home.seam$1</to>
  </rule>

  <!-- account / -->

  <rule>
    <from casesensitive="true">^/account/sign_in(.+)?$</from>
    <to last="true">/account/login.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/klogin(\?.+)?$</from>
    <to last="true">/account/klogin.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/sign_out(.+)?$</from>
    <to last="true">/account/logout.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/register(.+)?$</from>
    <to last="true">/account/register.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/activate/(.+)$</from>
    <to last="true">/account/activate.seam\?key=$1</to>
  </rule>
  <rule>
    <from casesensitive="true">^/account/activate(.+)?$</from>
    <to last="true">/account/activate.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/validate_email/([^?]*)(.*)$</from>
    <to last="true">/account/email_validation.seam\?key=$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/changepassword(.+)?$</from>
    <to last="true">/account/changepassword.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/password_reset_request(.+)?$</from>
    <to last="true">/account/password_reset_request.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/password_reset/(.+)$</from>
    <to last="true">/account/password_reset.seam\?key=$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/google_password_reset_request(.+)?$</from>
    <to last="true">/account/google_password_reset_request.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/account/inactive(.+)?$</from>
    <to last="true">/account/inactive_account.seam$1</to>
  </rule>

  <!-- Profile -->
  <rule>
    <from casesensitive="true">^/profile/edit(.+)?$</from>
    <to last="true">/profile/edit.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/create(.+)?$</from>
    <to last="true">/profile/create_user.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/add_identity(\?.*)?$</from>
    <to last="true">/profile/add_identity.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/merge_account(\?.*)?$</from>
    <to last="true">/profile/merge_account.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/view/(.+)$</from>
    <to
      last="true">/profile/home.seam\?username=$1
    </to>
  </rule>

  <rule>
    <from casesensitive="true">^/profile/$</from>
    <to last="true">/profile/home.seam</to>
  </rule>

  <!-- Translation Memory -->
  <rule>
    <from casesensitive="true">^/tm/?(\?.*)?$</from>
    <to last="true">/tm/home.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/tm/create(\?.*)?$</from>
    <to last="true">/tm/create.seam$1</to>
  </rule>

  <!-- ROOT / -->
  <rule>
    <from>^/$</from>
    <to>/home.seam</to>
  </rule>

  <rule>
    <from>^/admin/$</from>
    <to>/admin/home.seam</to>
  </rule>

  <rule>
    <from>^/error(\?.+)?$</from>
    <to>/error.seam$1</to>
  </rule>


  <!-- Rest Mappings -->

  <rule>
    <from casesensitive="true">^/rest/$</from>
    <to last="true">/rest/index.xrd</to>
  </rule>

  <rule>
    <from casesensitive="true">^/seam/resource/restv1/(.+)$</from>
    <to last="true">/rest/$1</to>
  </rule>

  <!-- Version group -->

  <rule>
    <from casesensitive="true">^/version-group/create(.+)$</from>
    <to last="true">/version-group/create_version_group.seam?$1</to>
  </rule>


  <rule>
    <from casesensitive="true">^/version-group/list(.+)?$</from>
    <to last="true">/version-group/home.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/version-group/view/([^/]+)(/([^?]*)\??(.*))?$
    </from>
    <to
      last="true">/version-group/version_group.seam\?versionGroupSlug=$1&amp;$4
    </to>
  </rule>

   <rule>
     <from casesensitive="true">^/glossary/(.+)?$</from>
     <to last="true">/glossary/view.seam$1</to>
   </rule>

  <!--  Editor workspace redirection from Application.html to Application.seam -->
  <rule>
    <from casesensitive="true">^/webtrans/Application.html(.*)$</from>
    <to last="true">/webtrans/Application.seam$1</to>
  </rule>

  <rule>
    <from casesensitive="true">^/webtrans/translate(.*)$</from>
    <to last="true">/webtrans/Application.seam$1</to>
  </rule>

  <!-- zanata-assets resource -->
  <!-- JSF serves zanata-assets with suffix of .seam,
      this is to make sure any reference to zanata-assets without .seam can access to the resource.
      e.g. jars/assets/style.css redirects to jars/assets/style.css.seam -->
  <rule>
    <from casesensitive="true">^/javax.faces.resource/jars/assets/(.*)(?&lt;!.seam)$</from>
    <to last="true">/javax.faces.resource/jars/assets/$1.seam</to>
  </rule>

  <outbound-rule>
    <from casesensitive="true">^([^?]*)\?dswid=([^&amp;]*)&amp;(.*)$</from>
    <to>$1?$3&amp;dswid=$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/dashboard/home.seam(.+)?$</from>
    <to>$1/dashboard/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/admin/(.+).seam(.*)$</from>
    <to>$1/admin/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/language/language.seam\?id=(.+)$</from>
    <to>$1/language/view/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/language/home.seam(.+)?$</from>
    <to>$1/language/list$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/add_iteration.seam\?projectSlug=([^&amp;]+)(?:&amp;copyFromVersionSlug=([^&amp;]+))?(.+)?$</from>
    <to>$1/project/add_iteration/$2/$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/project/add_iteration.seam\?copyFromVersionSlug=([^&amp;]+)&amp;projectSlug=([^&amp;]+)(.+)?$</from>
    <to>$1/project/add_iteration/$3/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/project/create_project.seam(.+)?$</from>
    <to>$1/project/create/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/project.seam\?slug=(.+)$</from>
    <to>$1/project/view/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/project.seam\?projectSlug=([^&amp;]+)&amp;iterationSlug=([^&amp;]+)(?:&amp;slug=[^&amp;]+)?&amp;actionMethod=project%2Fproject\.xhtml%3AconfigurationAction\.getData.*$</from>
    <to>$1/project/view/$2/iter/$3/config</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/project/home.seam(.+)?$</from>
    <to>$1/project/list$2</to>
  </outbound-rule>

  <!-- repeated to handle either param order (there should be a better way to do this) -->
  <outbound-rule>
    <from>^(/.+)?/iteration/view.seam\?projectSlug=([^&amp;]+)&amp;iterationSlug=([^&amp;]+)(&amp;(.+))?$</from>
    <to>$1/iteration/view/$2/$3</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/iteration/view.seam\?iterationSlug=([^&amp;]+)&amp;projectSlug=([^&amp;]+)(&amp;(.+))?$</from>
    <to>$1/iteration/view/$3/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/account/login.seam(.+)?$</from>
    <to>$1/account/sign_in$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/klogin.seam(.+)?$</from>
    <to>$1/account/klogin$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/logout.seam(.+)?$</from>
    <to>$1/account/sign_out$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/register.seam(.+)?$</from>
    <to>$1/account/register$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/activate.seam\?key=(.+)$</from>
    <to>$1/account/activate/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/activate.seam(.+)?$</from>
    <to>$1/account/activate$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/email_validation.seam\?key=(.+)$</from>
    <to>$1/account/validate_email/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/password_reset_request.seam(.+)?$</from>
    <to>$1/account/password_reset_request$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/password_reset.seam\?key=(.+)$</from>
    <to>$1/account/password_reset/$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/google_password_reset_request.seam(.+)?$</from>
    <to>$1/account/google_password_reset_request$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/account/inactive_account.seam(.+)?$</from>
    <to>$1/account/inactive$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/home.seam(.+)?$</from>
    <to>$1/version-group/list$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/create_version_group.seam(.+)?$</from>
    <to>$1/version-group/create/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/version-group/version_group.seam\?versionGroupSlug=(.+)$</from>
    <to>$1/version-group/view/$2</to>
  </outbound-rule>

   <outbound-rule>
     <from>^(/.+)?/glossary/view.seam(.+)?$</from>
     <to>$1/glossary/$2</to>
   </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/profile/create_user.seam(.+)?$</from>
    <to>$1/profile/create$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/profile/merge_account.seam(.+)?$</from>
    <to>$1/profile/merge_account$2</to>
  </outbound-rule>
  <outbound-rule>
    <from>^(/.+)?/profile/home.seam\?username=(.+)$</from>
    <to>$1/profile/view/$2</to>
  </outbound-rule>


  <outbound-rule>
    <from>^(/.+)?/tm/create.seam(.+)?$</from>
    <to>$1/tm/create$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/home.seam(.+)?$</from>
    <to>$1/$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/help/view.seam(.+)?$</from>
    <to>$1/help/view$2</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/error.seam(.+)?$</from>
    <to>$1/error$2</to>
  </outbound-rule>

  <!--  Editor workspace redirection from Application.html to Application.seam -->
  <outbound-rule>
    <from>^(/.+)?/webtrans/Application.seam(.*)$</from>
    <to>$1/webtrans/translate$2</to>
  </outbound-rule>

  <!-- Removing .seam from rest url  -->
  <outbound-rule>
    <from>^(/.+)?/rest/file/translation/(.+).seam(.+)$</from>
    <to>$1/rest/file/translation/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/rest/file/source/(.+).seam(.+)$</from>
    <to>$1/rest/file/source/$2$3</to>
  </outbound-rule>

  <outbound-rule>
    <from>^(/.+)?/rest/tm/(.+).seam(.*)$</from>
    <to>$1/rest/tm/$2$3</to>
  </outbound-rule>

</urlrewrite>
